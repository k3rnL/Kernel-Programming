#include "io.h"
#include "idt.h"

#define IDTBASE  0x800		/* addr. physique ou doit resider la IDT */
#define IDTSIZE  0xFF		/* nombre max. de descripteurs dans la table */

#define INTGATE  0x8E00		/* utilise pour gerer les interruptions */

extern void isr_oui();
extern void idt_load();
extern void interrupt_0();
extern void interrupt_1();
extern void interrupt_2();
extern void interrupt_3();
extern void interrupt_4();
extern void interrupt_5();
extern void interrupt_6();
extern void interrupt_7();
extern void interrupt_8();
extern void interrupt_9();
extern void interrupt_10();
extern void interrupt_11();
extern void interrupt_12();
extern void interrupt_13();
extern void interrupt_14();
extern void interrupt_15();
extern void interrupt_16();
extern void interrupt_17();
extern void interrupt_18();
extern void interrupt_19();
extern void interrupt_20();
extern void interrupt_21();
extern void interrupt_22();
extern void interrupt_23();
extern void interrupt_24();
extern void interrupt_25();
extern void interrupt_26();
extern void interrupt_27();
extern void interrupt_28();
extern void interrupt_29();
extern void interrupt_30();
extern void interrupt_31();
extern void interrupt_32();
extern void interrupt_33();
extern void interrupt_34();
extern void interrupt_35();
extern void interrupt_36();
extern void interrupt_37();
extern void interrupt_38();
extern void interrupt_39();
extern void interrupt_40();
extern void interrupt_41();
extern void interrupt_42();
extern void interrupt_43();
extern void interrupt_44();
extern void interrupt_45();
extern void interrupt_46();
extern void interrupt_47();
extern void interrupt_48();
extern void interrupt_49();
extern void interrupt_50();
extern void interrupt_51();
extern void interrupt_52();
extern void interrupt_53();
extern void interrupt_54();
extern void interrupt_55();
extern void interrupt_56();
extern void interrupt_57();
extern void interrupt_58();
extern void interrupt_59();
extern void interrupt_60();
extern void interrupt_61();
extern void interrupt_62();
extern void interrupt_63();
extern void interrupt_64();
extern void interrupt_65();
extern void interrupt_66();
extern void interrupt_67();
extern void interrupt_68();
extern void interrupt_69();
extern void interrupt_70();
extern void interrupt_71();
extern void interrupt_72();
extern void interrupt_73();
extern void interrupt_74();
extern void interrupt_75();
extern void interrupt_76();
extern void interrupt_77();
extern void interrupt_78();
extern void interrupt_79();
extern void interrupt_80();
extern void interrupt_81();
extern void interrupt_82();
extern void interrupt_83();
extern void interrupt_84();
extern void interrupt_85();
extern void interrupt_86();
extern void interrupt_87();
extern void interrupt_88();
extern void interrupt_89();
extern void interrupt_90();
extern void interrupt_91();
extern void interrupt_92();
extern void interrupt_93();
extern void interrupt_94();
extern void interrupt_95();
extern void interrupt_96();
extern void interrupt_97();
extern void interrupt_98();
extern void interrupt_99();
extern void interrupt_100();
extern void interrupt_101();
extern void interrupt_102();
extern void interrupt_103();
extern void interrupt_104();
extern void interrupt_105();
extern void interrupt_106();
extern void interrupt_107();
extern void interrupt_108();
extern void interrupt_109();
extern void interrupt_110();
extern void interrupt_111();
extern void interrupt_112();
extern void interrupt_113();
extern void interrupt_114();
extern void interrupt_115();
extern void interrupt_116();
extern void interrupt_117();
extern void interrupt_118();
extern void interrupt_119();
extern void interrupt_120();
extern void interrupt_121();
extern void interrupt_122();
extern void interrupt_123();
extern void interrupt_124();
extern void interrupt_125();
extern void interrupt_126();
extern void interrupt_127();
extern void interrupt_128();
extern void interrupt_129();
extern void interrupt_130();
extern void interrupt_131();
extern void interrupt_132();
extern void interrupt_133();
extern void interrupt_134();
extern void interrupt_135();
extern void interrupt_136();
extern void interrupt_137();
extern void interrupt_138();
extern void interrupt_139();
extern void interrupt_140();
extern void interrupt_141();
extern void interrupt_142();
extern void interrupt_143();
extern void interrupt_144();
extern void interrupt_145();
extern void interrupt_146();
extern void interrupt_147();
extern void interrupt_148();
extern void interrupt_149();
extern void interrupt_150();
extern void interrupt_151();
extern void interrupt_152();
extern void interrupt_153();
extern void interrupt_154();
extern void interrupt_155();
extern void interrupt_156();
extern void interrupt_157();
extern void interrupt_158();
extern void interrupt_159();
extern void interrupt_160();
extern void interrupt_161();
extern void interrupt_162();
extern void interrupt_163();
extern void interrupt_164();
extern void interrupt_165();
extern void interrupt_166();
extern void interrupt_167();
extern void interrupt_168();
extern void interrupt_169();
extern void interrupt_170();
extern void interrupt_171();
extern void interrupt_172();
extern void interrupt_173();
extern void interrupt_174();
extern void interrupt_175();
extern void interrupt_176();
extern void interrupt_177();
extern void interrupt_178();
extern void interrupt_179();
extern void interrupt_180();
extern void interrupt_181();
extern void interrupt_182();
extern void interrupt_183();
extern void interrupt_184();
extern void interrupt_185();
extern void interrupt_186();
extern void interrupt_187();
extern void interrupt_188();
extern void interrupt_189();
extern void interrupt_190();
extern void interrupt_191();
extern void interrupt_192();
extern void interrupt_193();
extern void interrupt_194();
extern void interrupt_195();
extern void interrupt_196();
extern void interrupt_197();
extern void interrupt_198();
extern void interrupt_199();
extern void interrupt_200();
extern void interrupt_201();
extern void interrupt_202();
extern void interrupt_203();
extern void interrupt_204();
extern void interrupt_205();
extern void interrupt_206();
extern void interrupt_207();
extern void interrupt_208();
extern void interrupt_209();
extern void interrupt_210();
extern void interrupt_211();
extern void interrupt_212();
extern void interrupt_213();
extern void interrupt_214();
extern void interrupt_215();
extern void interrupt_216();
extern void interrupt_217();
extern void interrupt_218();
extern void interrupt_219();
extern void interrupt_220();
extern void interrupt_221();
extern void interrupt_222();
extern void interrupt_223();
extern void interrupt_224();
extern void interrupt_225();
extern void interrupt_226();
extern void interrupt_227();
extern void interrupt_228();
extern void interrupt_229();
extern void interrupt_230();
extern void interrupt_231();
extern void interrupt_232();
extern void interrupt_233();
extern void interrupt_234();
extern void interrupt_235();
extern void interrupt_236();
extern void interrupt_237();
extern void interrupt_238();
extern void interrupt_239();
extern void interrupt_240();
extern void interrupt_241();
extern void interrupt_242();
extern void interrupt_243();
extern void interrupt_244();
extern void interrupt_245();
extern void interrupt_246();
extern void interrupt_247();
extern void interrupt_248();
extern void interrupt_249();
extern void interrupt_250();
extern void interrupt_251();
extern void interrupt_252();
extern void interrupt_253();
extern void interrupt_254();
extern void interrupt_255();


void _asm_default_int(void);

/* #define ISR_NO_ERROR(N) \ */
/*   __asm__ volatile("\ */
/*        _asm_isr_"#N ": \n			   \ */
/*                 push $0 \n \ */
/*                 push $"#N " \n \ */
/*                 jmp _asm_default_int"); */
//ERROR


/* ISR_NO_ERROR(0); */
/* ISR_NO_ERROR(1); */
/* ISR_NO_ERROR(2); */
/* ISR_NO_ERROR(3); */
/* ISR_NO_ERROR(4); */
/* ISR_ERROR(8); */
/* ... */

struct idtdesc
{
	u16 offset0_15;
	u16 select;
	u16 type;
	u16 offset16_31;
} __attribute__((packed));

/* Registre IDTR */
struct idtr {
	u16 limite;
	u32 base;
} __attribute__ ((packed));

struct idtr idtr; /* Registre IDTR */
struct idtdesc idt[IDTSIZE]; /* Table de IDT */


/* struct idtdesc_t */
/* { */
/*   gs */
/*   fs */
/*   ... */
/*   ebx */
/*   eax */
/*   num_int */
/*   error */
/*   eip */
/*   cs */
/*   eflags */
/*   esp */
/*   ss */
/* } __attribute__((packed)); */

void generic_c_handler(void)
{
  printf("coucou\n");
  // if s->num_int < 32
  //	 exception
  //if  32 >= <= 32+15
  //	 IRQ
  //		EOI();
  //if  == 0x80
  //      SYSCALL
}

void isr_default_int(void)
{
	printf("interrupt\n");
}

void isr_clock_int(void)
{
}

void _asm_default_int()
{
  __asm__ volatile("call _asm_default_int_asm");




  /* asm volatile ("call generic_c_handler \n	\ */
  /* 	movb $0x20, %al \n \ */
  /* 	outb %al, $0x20 \n \ */
  /* 	iret"); */


      /* __asm__ volatile(;<save registers> \ */
      /* 		       pushl %esp	      \ */
      /* 		       call generic_c_handler \ */
      /* 		       add $4, %esp \ */
      /* 		       ;<restore registers> \ */
      /* 		       add $8, %esp \ */
      /* 		       iret) */

}

/* __asm__ volatile(" \ */
/* _asm_default_int: \n \ */
/* 	u16 offset0_15; */
/* 	u16 select; */
/* 	u16 type; */
/* 	u16 offset16_31; */
/* 	u16 offset0_15; */
/* 	u16 select; */
/* 	u16 type; */
/* 	u16 offset16_31; */
/*  push %eax \n		 \ */
/*  push %ebx */
/*  ... */
/*  push fs */
/*  push gs */
/*  push %esp */
/*  call generic_c_handler */
/*  ... */
/* 	        iret"); */



void init_idt_desc(u16 select, u32 function_ptr, u16 type, u32 nb)
{
  idt[nb].offset0_15 = (function_ptr & 0xffff);
  idt[nb].select = select;
  idt[nb].type = type;
  idt[nb].offset16_31 = (function_ptr & 0xffff0000) >> 16;
}

void memcpy(char *dest, char *src, size_t size)
{
  for (size_t i = 0 ; i < size ; i++) {
    *dest = *src;
    dest++;
    src++;
  }
}

void init_idt()
{
  printf("VOILA\n");
  /* Initialisation des descripteurs systeme par defaut */
  for (unsigned int i = 0; i < IDTSIZE; i++) 
    init_idt_desc(0x08, (u32) isr_oui, INTGATE, i);
  
  //init_idt_desc(0x08, (u32) _asm_irq_0, INTGATE, 33);
  /*
init_idt_desc(0x08, (u32) interrupt_1, INTGATE, 1);
init_idt_desc(0x08, (u32) interrupt_2, INTGATE, 2);
init_idt_desc(0x08, (u32) interrupt_3, INTGATE, 3);
init_idt_desc(0x08, (u32) interrupt_4, INTGATE, 4);
init_idt_desc(0x08, (u32) interrupt_5, INTGATE, 5);
init_idt_desc(0x08, (u32) interrupt_6, INTGATE, 6);
init_idt_desc(0x08, (u32) interrupt_7, INTGATE, 7);
init_idt_desc(0x08, (u32) interrupt_8, INTGATE, 8);
init_idt_desc(0x08, (u32) interrupt_9, INTGATE, 9);
init_idt_desc(0x08, (u32) interrupt_10, INTGATE, 10);
init_idt_desc(0x08, (u32) interrupt_11, INTGATE, 11);
init_idt_desc(0x08, (u32) interrupt_12, INTGATE, 12);
init_idt_desc(0x08, (u32) interrupt_13, INTGATE, 13);
init_idt_desc(0x08, (u32) interrupt_14, INTGATE, 14);
init_idt_desc(0x08, (u32) interrupt_15, INTGATE, 15);
init_idt_desc(0x08, (u32) interrupt_16, INTGATE, 16);
init_idt_desc(0x08, (u32) interrupt_17, INTGATE, 17);
init_idt_desc(0x08, (u32) interrupt_18, INTGATE, 18);
init_idt_desc(0x08, (u32) interrupt_19, INTGATE, 19);
init_idt_desc(0x08, (u32) interrupt_20, INTGATE, 20);
init_idt_desc(0x08, (u32) interrupt_21, INTGATE, 21);
init_idt_desc(0x08, (u32) interrupt_22, INTGATE, 22);
init_idt_desc(0x08, (u32) interrupt_23, INTGATE, 23);
init_idt_desc(0x08, (u32) interrupt_24, INTGATE, 24);
init_idt_desc(0x08, (u32) interrupt_25, INTGATE, 25);
init_idt_desc(0x08, (u32) interrupt_26, INTGATE, 26);
init_idt_desc(0x08, (u32) interrupt_27, INTGATE, 27);
init_idt_desc(0x08, (u32) interrupt_28, INTGATE, 28);
init_idt_desc(0x08, (u32) interrupt_29, INTGATE, 29);
init_idt_desc(0x08, (u32) interrupt_30, INTGATE, 30);
init_idt_desc(0x08, (u32) interrupt_31, INTGATE, 31);
init_idt_desc(0x08, (u32) interrupt_32, INTGATE, 32);
init_idt_desc(0x08, (u32) interrupt_33, INTGATE, 33);
init_idt_desc(0x08, (u32) interrupt_34, INTGATE, 34);
init_idt_desc(0x08, (u32) interrupt_35, INTGATE, 35);
init_idt_desc(0x08, (u32) interrupt_36, INTGATE, 36);
init_idt_desc(0x08, (u32) interrupt_37, INTGATE, 37);
init_idt_desc(0x08, (u32) interrupt_38, INTGATE, 38);
init_idt_desc(0x08, (u32) interrupt_39, INTGATE, 39);
init_idt_desc(0x08, (u32) interrupt_40, INTGATE, 40);
init_idt_desc(0x08, (u32) interrupt_41, INTGATE, 41);
init_idt_desc(0x08, (u32) interrupt_42, INTGATE, 42);
init_idt_desc(0x08, (u32) interrupt_43, INTGATE, 43);
init_idt_desc(0x08, (u32) interrupt_44, INTGATE, 44);
init_idt_desc(0x08, (u32) interrupt_45, INTGATE, 45);
init_idt_desc(0x08, (u32) interrupt_46, INTGATE, 46);
init_idt_desc(0x08, (u32) interrupt_47, INTGATE, 47);
init_idt_desc(0x08, (u32) interrupt_48, INTGATE, 48);
init_idt_desc(0x08, (u32) interrupt_49, INTGATE, 49);
init_idt_desc(0x08, (u32) interrupt_50, INTGATE, 50);
init_idt_desc(0x08, (u32) interrupt_51, INTGATE, 51);
init_idt_desc(0x08, (u32) interrupt_52, INTGATE, 52);
init_idt_desc(0x08, (u32) interrupt_53, INTGATE, 53);
init_idt_desc(0x08, (u32) interrupt_54, INTGATE, 54);
init_idt_desc(0x08, (u32) interrupt_55, INTGATE, 55);
init_idt_desc(0x08, (u32) interrupt_56, INTGATE, 56);
init_idt_desc(0x08, (u32) interrupt_57, INTGATE, 57);
init_idt_desc(0x08, (u32) interrupt_58, INTGATE, 58);
init_idt_desc(0x08, (u32) interrupt_59, INTGATE, 59);
init_idt_desc(0x08, (u32) interrupt_60, INTGATE, 60);
init_idt_desc(0x08, (u32) interrupt_61, INTGATE, 61);
init_idt_desc(0x08, (u32) interrupt_62, INTGATE, 62);
init_idt_desc(0x08, (u32) interrupt_63, INTGATE, 63);
init_idt_desc(0x08, (u32) interrupt_64, INTGATE, 64);
init_idt_desc(0x08, (u32) interrupt_65, INTGATE, 65);
init_idt_desc(0x08, (u32) interrupt_66, INTGATE, 66);
init_idt_desc(0x08, (u32) interrupt_67, INTGATE, 67);
init_idt_desc(0x08, (u32) interrupt_68, INTGATE, 68);
init_idt_desc(0x08, (u32) interrupt_69, INTGATE, 69);
init_idt_desc(0x08, (u32) interrupt_70, INTGATE, 70);
init_idt_desc(0x08, (u32) interrupt_71, INTGATE, 71);
init_idt_desc(0x08, (u32) interrupt_72, INTGATE, 72);
init_idt_desc(0x08, (u32) interrupt_73, INTGATE, 73);
init_idt_desc(0x08, (u32) interrupt_74, INTGATE, 74);
init_idt_desc(0x08, (u32) interrupt_75, INTGATE, 75);
init_idt_desc(0x08, (u32) interrupt_76, INTGATE, 76);
init_idt_desc(0x08, (u32) interrupt_77, INTGATE, 77);
init_idt_desc(0x08, (u32) interrupt_78, INTGATE, 78);
init_idt_desc(0x08, (u32) interrupt_79, INTGATE, 79);
init_idt_desc(0x08, (u32) interrupt_80, INTGATE, 80);
init_idt_desc(0x08, (u32) interrupt_81, INTGATE, 81);
init_idt_desc(0x08, (u32) interrupt_82, INTGATE, 82);
init_idt_desc(0x08, (u32) interrupt_83, INTGATE, 83);
init_idt_desc(0x08, (u32) interrupt_84, INTGATE, 84);
init_idt_desc(0x08, (u32) interrupt_85, INTGATE, 85);
init_idt_desc(0x08, (u32) interrupt_86, INTGATE, 86);
init_idt_desc(0x08, (u32) interrupt_87, INTGATE, 87);
init_idt_desc(0x08, (u32) interrupt_88, INTGATE, 88);
init_idt_desc(0x08, (u32) interrupt_89, INTGATE, 89);
init_idt_desc(0x08, (u32) interrupt_90, INTGATE, 90);
init_idt_desc(0x08, (u32) interrupt_91, INTGATE, 91);
init_idt_desc(0x08, (u32) interrupt_92, INTGATE, 92);
init_idt_desc(0x08, (u32) interrupt_93, INTGATE, 93);
init_idt_desc(0x08, (u32) interrupt_94, INTGATE, 94);
init_idt_desc(0x08, (u32) interrupt_95, INTGATE, 95);
init_idt_desc(0x08, (u32) interrupt_96, INTGATE, 96);
init_idt_desc(0x08, (u32) interrupt_97, INTGATE, 97);
init_idt_desc(0x08, (u32) interrupt_98, INTGATE, 98);
init_idt_desc(0x08, (u32) interrupt_99, INTGATE, 99);
init_idt_desc(0x08, (u32) interrupt_100, INTGATE, 100);
init_idt_desc(0x08, (u32) interrupt_101, INTGATE, 101);
init_idt_desc(0x08, (u32) interrupt_102, INTGATE, 102);
init_idt_desc(0x08, (u32) interrupt_103, INTGATE, 103);
init_idt_desc(0x08, (u32) interrupt_104, INTGATE, 104);
init_idt_desc(0x08, (u32) interrupt_105, INTGATE, 105);
init_idt_desc(0x08, (u32) interrupt_106, INTGATE, 106);
init_idt_desc(0x08, (u32) interrupt_107, INTGATE, 107);
init_idt_desc(0x08, (u32) interrupt_108, INTGATE, 108);
init_idt_desc(0x08, (u32) interrupt_109, INTGATE, 109);
init_idt_desc(0x08, (u32) interrupt_110, INTGATE, 110);
init_idt_desc(0x08, (u32) interrupt_111, INTGATE, 111);
init_idt_desc(0x08, (u32) interrupt_112, INTGATE, 112);
init_idt_desc(0x08, (u32) interrupt_113, INTGATE, 113);
init_idt_desc(0x08, (u32) interrupt_114, INTGATE, 114);
init_idt_desc(0x08, (u32) interrupt_115, INTGATE, 115);
init_idt_desc(0x08, (u32) interrupt_116, INTGATE, 116);
init_idt_desc(0x08, (u32) interrupt_117, INTGATE, 117);
init_idt_desc(0x08, (u32) interrupt_118, INTGATE, 118);
init_idt_desc(0x08, (u32) interrupt_119, INTGATE, 119);
init_idt_desc(0x08, (u32) interrupt_120, INTGATE, 120);
init_idt_desc(0x08, (u32) interrupt_121, INTGATE, 121);
init_idt_desc(0x08, (u32) interrupt_122, INTGATE, 122);
init_idt_desc(0x08, (u32) interrupt_123, INTGATE, 123);
init_idt_desc(0x08, (u32) interrupt_124, INTGATE, 124);
init_idt_desc(0x08, (u32) interrupt_125, INTGATE, 125);
init_idt_desc(0x08, (u32) interrupt_126, INTGATE, 126);
init_idt_desc(0x08, (u32) interrupt_127, INTGATE, 127);
init_idt_desc(0x08, (u32) interrupt_128, INTGATE, 128);
init_idt_desc(0x08, (u32) interrupt_129, INTGATE, 129);
init_idt_desc(0x08, (u32) interrupt_130, INTGATE, 130);
init_idt_desc(0x08, (u32) interrupt_131, INTGATE, 131);
init_idt_desc(0x08, (u32) interrupt_132, INTGATE, 132);
init_idt_desc(0x08, (u32) interrupt_133, INTGATE, 133);
init_idt_desc(0x08, (u32) interrupt_134, INTGATE, 134);
init_idt_desc(0x08, (u32) interrupt_135, INTGATE, 135);
init_idt_desc(0x08, (u32) interrupt_136, INTGATE, 136);
init_idt_desc(0x08, (u32) interrupt_137, INTGATE, 137);
init_idt_desc(0x08, (u32) interrupt_138, INTGATE, 138);
init_idt_desc(0x08, (u32) interrupt_139, INTGATE, 139);
init_idt_desc(0x08, (u32) interrupt_140, INTGATE, 140);
init_idt_desc(0x08, (u32) interrupt_141, INTGATE, 141);
init_idt_desc(0x08, (u32) interrupt_142, INTGATE, 142);
init_idt_desc(0x08, (u32) interrupt_143, INTGATE, 143);
init_idt_desc(0x08, (u32) interrupt_144, INTGATE, 144);
init_idt_desc(0x08, (u32) interrupt_145, INTGATE, 145);
init_idt_desc(0x08, (u32) interrupt_146, INTGATE, 146);
init_idt_desc(0x08, (u32) interrupt_147, INTGATE, 147);
init_idt_desc(0x08, (u32) interrupt_148, INTGATE, 148);
init_idt_desc(0x08, (u32) interrupt_149, INTGATE, 149);
init_idt_desc(0x08, (u32) interrupt_150, INTGATE, 150);
init_idt_desc(0x08, (u32) interrupt_151, INTGATE, 151);
init_idt_desc(0x08, (u32) interrupt_152, INTGATE, 152);
init_idt_desc(0x08, (u32) interrupt_153, INTGATE, 153);
init_idt_desc(0x08, (u32) interrupt_154, INTGATE, 154);
init_idt_desc(0x08, (u32) interrupt_155, INTGATE, 155);
init_idt_desc(0x08, (u32) interrupt_156, INTGATE, 156);
init_idt_desc(0x08, (u32) interrupt_157, INTGATE, 157);
init_idt_desc(0x08, (u32) interrupt_158, INTGATE, 158);
init_idt_desc(0x08, (u32) interrupt_159, INTGATE, 159);
init_idt_desc(0x08, (u32) interrupt_160, INTGATE, 160);
init_idt_desc(0x08, (u32) interrupt_161, INTGATE, 161);
init_idt_desc(0x08, (u32) interrupt_162, INTGATE, 162);
init_idt_desc(0x08, (u32) interrupt_163, INTGATE, 163);
init_idt_desc(0x08, (u32) interrupt_164, INTGATE, 164);
init_idt_desc(0x08, (u32) interrupt_165, INTGATE, 165);
init_idt_desc(0x08, (u32) interrupt_166, INTGATE, 166);
init_idt_desc(0x08, (u32) interrupt_167, INTGATE, 167);
init_idt_desc(0x08, (u32) interrupt_168, INTGATE, 168);
init_idt_desc(0x08, (u32) interrupt_169, INTGATE, 169);
init_idt_desc(0x08, (u32) interrupt_170, INTGATE, 170);
init_idt_desc(0x08, (u32) interrupt_171, INTGATE, 171);
init_idt_desc(0x08, (u32) interrupt_172, INTGATE, 172);
init_idt_desc(0x08, (u32) interrupt_173, INTGATE, 173);
init_idt_desc(0x08, (u32) interrupt_174, INTGATE, 174);
init_idt_desc(0x08, (u32) interrupt_175, INTGATE, 175);
init_idt_desc(0x08, (u32) interrupt_176, INTGATE, 176);
init_idt_desc(0x08, (u32) interrupt_177, INTGATE, 177);
init_idt_desc(0x08, (u32) interrupt_178, INTGATE, 178);
init_idt_desc(0x08, (u32) interrupt_179, INTGATE, 179);
init_idt_desc(0x08, (u32) interrupt_180, INTGATE, 180);
init_idt_desc(0x08, (u32) interrupt_181, INTGATE, 181);
init_idt_desc(0x08, (u32) interrupt_182, INTGATE, 182);
init_idt_desc(0x08, (u32) interrupt_183, INTGATE, 183);
init_idt_desc(0x08, (u32) interrupt_184, INTGATE, 184);
init_idt_desc(0x08, (u32) interrupt_185, INTGATE, 185);
init_idt_desc(0x08, (u32) interrupt_186, INTGATE, 186);
init_idt_desc(0x08, (u32) interrupt_187, INTGATE, 187);
init_idt_desc(0x08, (u32) interrupt_188, INTGATE, 188);
init_idt_desc(0x08, (u32) interrupt_189, INTGATE, 189);
init_idt_desc(0x08, (u32) interrupt_190, INTGATE, 190);
init_idt_desc(0x08, (u32) interrupt_191, INTGATE, 191);
init_idt_desc(0x08, (u32) interrupt_192, INTGATE, 192);
init_idt_desc(0x08, (u32) interrupt_193, INTGATE, 193);
init_idt_desc(0x08, (u32) interrupt_194, INTGATE, 194);
init_idt_desc(0x08, (u32) interrupt_195, INTGATE, 195);
init_idt_desc(0x08, (u32) interrupt_196, INTGATE, 196);
init_idt_desc(0x08, (u32) interrupt_197, INTGATE, 197);
init_idt_desc(0x08, (u32) interrupt_198, INTGATE, 198);
init_idt_desc(0x08, (u32) interrupt_199, INTGATE, 199);
init_idt_desc(0x08, (u32) interrupt_200, INTGATE, 200);
init_idt_desc(0x08, (u32) interrupt_201, INTGATE, 201);
init_idt_desc(0x08, (u32) interrupt_202, INTGATE, 202);
init_idt_desc(0x08, (u32) interrupt_203, INTGATE, 203);
init_idt_desc(0x08, (u32) interrupt_204, INTGATE, 204);
init_idt_desc(0x08, (u32) interrupt_205, INTGATE, 205);
init_idt_desc(0x08, (u32) interrupt_206, INTGATE, 206);
init_idt_desc(0x08, (u32) interrupt_207, INTGATE, 207);
init_idt_desc(0x08, (u32) interrupt_208, INTGATE, 208);
init_idt_desc(0x08, (u32) interrupt_209, INTGATE, 209);
init_idt_desc(0x08, (u32) interrupt_210, INTGATE, 210);
init_idt_desc(0x08, (u32) interrupt_211, INTGATE, 211);
init_idt_desc(0x08, (u32) interrupt_212, INTGATE, 212);
init_idt_desc(0x08, (u32) interrupt_213, INTGATE, 213);
init_idt_desc(0x08, (u32) interrupt_214, INTGATE, 214);
init_idt_desc(0x08, (u32) interrupt_215, INTGATE, 215);
init_idt_desc(0x08, (u32) interrupt_216, INTGATE, 216);
init_idt_desc(0x08, (u32) interrupt_217, INTGATE, 217);
init_idt_desc(0x08, (u32) interrupt_218, INTGATE, 218);
init_idt_desc(0x08, (u32) interrupt_219, INTGATE, 219);
init_idt_desc(0x08, (u32) interrupt_220, INTGATE, 220);
init_idt_desc(0x08, (u32) interrupt_221, INTGATE, 221);
init_idt_desc(0x08, (u32) interrupt_222, INTGATE, 222);
init_idt_desc(0x08, (u32) interrupt_223, INTGATE, 223);
init_idt_desc(0x08, (u32) interrupt_224, INTGATE, 224);
init_idt_desc(0x08, (u32) interrupt_225, INTGATE, 225);
init_idt_desc(0x08, (u32) interrupt_226, INTGATE, 226);
init_idt_desc(0x08, (u32) interrupt_227, INTGATE, 227);
init_idt_desc(0x08, (u32) interrupt_228, INTGATE, 228);
init_idt_desc(0x08, (u32) interrupt_229, INTGATE, 229);
init_idt_desc(0x08, (u32) interrupt_230, INTGATE, 230);
init_idt_desc(0x08, (u32) interrupt_231, INTGATE, 231);
init_idt_desc(0x08, (u32) interrupt_232, INTGATE, 232);
init_idt_desc(0x08, (u32) interrupt_233, INTGATE, 233);
init_idt_desc(0x08, (u32) interrupt_234, INTGATE, 234);
init_idt_desc(0x08, (u32) interrupt_235, INTGATE, 235);
init_idt_desc(0x08, (u32) interrupt_236, INTGATE, 236);
init_idt_desc(0x08, (u32) interrupt_237, INTGATE, 237);
init_idt_desc(0x08, (u32) interrupt_238, INTGATE, 238);
init_idt_desc(0x08, (u32) interrupt_239, INTGATE, 239);
init_idt_desc(0x08, (u32) interrupt_240, INTGATE, 240);
init_idt_desc(0x08, (u32) interrupt_241, INTGATE, 241);
init_idt_desc(0x08, (u32) interrupt_242, INTGATE, 242);
init_idt_desc(0x08, (u32) interrupt_243, INTGATE, 243);
init_idt_desc(0x08, (u32) interrupt_244, INTGATE, 244);
init_idt_desc(0x08, (u32) interrupt_245, INTGATE, 245);
init_idt_desc(0x08, (u32) interrupt_246, INTGATE, 246);
init_idt_desc(0x08, (u32) interrupt_247, INTGATE, 247);
init_idt_desc(0x08, (u32) interrupt_248, INTGATE, 248);
init_idt_desc(0x08, (u32) interrupt_249, INTGATE, 249);
init_idt_desc(0x08, (u32) interrupt_250, INTGATE, 250);
init_idt_desc(0x08, (u32) interrupt_251, INTGATE, 251);
init_idt_desc(0x08, (u32) interrupt_252, INTGATE, 252);
init_idt_desc(0x08, (u32) interrupt_253, INTGATE, 253);
init_idt_desc(0x08, (u32) interrupt_254, INTGATE, 254);
  */

  
/* Initialisation de la structure pour IDTR */
  idtr.limite = 255 - 1;
  idtr.base = (u32)idt;
  
 
  memcpy((char *) idtr.base, (char *) idt, idtr.limite);
  
  //  idt_load();

  asm volatile("lidt %0\n"
               : /* no output */
               : "m" (idtr) 
               : "memory");
  asm("sti"::);
  //	asm("lidtl (idtr)");
  
  
  
  
  
  /* struct idt_r idtr;		 */
  /* idtr.base = (u32)idt; /\* idt base address *\/ */
  /* idtr.limit = sizeof(idt) - 1; /\* idt size - 1 *\/ */
  /* __asm__ volatile("lidt %0\n" */
  /* 		   : /\* no output *\/ */
  /* 		   : "m" (idtr) */
  /* 		   : "memory"); */
}
